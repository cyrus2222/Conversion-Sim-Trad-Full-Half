<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>簡繁．全形半形 即時轉換器</title>
  <link rel="icon" type="image/png" href="ICON.png" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#94a3b8; --accent:#f59e0b; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Microsoft JhengHei", sans-serif; background:var(--bg); color:var(--ink);}
    header { padding:20px; border-bottom:1px solid #1f2937; }
    h1 { margin:0; font-size:20px; letter-spacing:.5px; }
    .wrap { max-width:1100px; margin:24px auto; padding:0 16px; display:grid; gap:16px; grid-template-columns:1fr; }
    .panel { background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:16px; }
    textarea { width:100%; min-height:260px; resize:vertical; background:#0b1220; color:var(--ink); border:1px solid #1f2937; border-radius:12px; padding:12px; font-size:15px; line-height:1.6; }
    .bar { display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    button {
      border:1px solid #334155; background:#0b1220; color:var(--ink);
      padding:10px 18px; border-radius:999px; cursor:pointer; font-size:14px;
      transition: all .2s;
    }
    button:hover { border-color:var(--accent); }
    button.active {
      background:var(--accent);
      color:#000;
      border-color:var(--accent);
      font-weight:600;
    }
    .muted { color:var(--muted); font-size:12px; margin-top:8px; }
    .two { display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width: 900px) { .two{ grid-template-columns:1fr 1fr; } }
    .tag { display:inline-block; padding:2px 8px; border:1px solid #334155; border-radius:999px; font-size:12px; color:var(--muted); }
    .footer { text-align:center; color:var(--muted); font-size:12px; padding:24px 0 40px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>
</head>
<body>
  <header>
    <h1>簡繁．全形半形 即時轉換器 <span class="tag">本地即時</span></h1>
  </header>

  <main class="wrap">
    <section class="two">
      <div class="panel">
        <h3 style="margin:0 0 8px;">輸入</h3>
        <textarea id="input" placeholder="貼上或輸入文字…"></textarea>
        <div class="bar">
          <button id="btnClear">清空</button>
          <button id="btnCopyIn">複製輸入</button>
        </div>
      </div>

      <div class="panel">
        <h3 style="margin:0 0 8px;">即時預覽</h3>
        <textarea id="output" readonly placeholder="結果會即時顯示"></textarea>
        <div class="bar">
          <button id="btnCopyOut">複製結果</button>
        </div>
      </div>
    </section>

    <section class="panel">
      <h3 style="margin:0 0 8px;">轉換模式</h3>
      <div class="bar">
        <button class="mode-btn" data-group="sc" data-mode="t2s">繁 → 簡</button>
        <button class="mode-btn" data-group="sc" data-mode="s2t">簡 → 繁（臺灣）</button>
        <span style="width:8px;"></span>
        <button class="mode-btn" data-group="width" data-mode="fw2hw">全形 → 半形</button>
        <button class="mode-btn" data-group="width" data-mode="hw2fw">半形 → 全形</button>
      </div>
      <p class="muted">簡繁、全半形轉換可同時啟動</p>
    </section>
  </main>

  <div class="footer">opencc-js 詞彙級簡繁轉換｜全形半形為原生映射</div>

  <script>
    // 全形 ↔ 半形
    const toHalfWidth = str => str
      .replace(/\u3000/g, ' ')
      .replace(/[\uFF01-\uFF5E]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0xFEE0));

    const toFullWidth = str => str
      .replace(/ /g, '\u3000')
      .replace(/[!-~]/g, ch => String.fromCharCode(ch.charCodeAt(0) + 0xFEE0));

    // OpenCC
    let convT2S = null, convS2T = null;
    const ensureOpenCC = () => {
      if (!window.OpenCC) return false;
      if (!convT2S) convT2S = OpenCC.Converter({ from: 'tw', to: 'cn' });
      if (!convS2T) convS2T = OpenCC.Converter({ from: 'cn', to: 'twp' });
      return true;
    };

    const $in   = document.getElementById('input');
    const $out  = document.getElementById('output');

    // 目前選中的模式（兩組互斥）
    let scMode = null;     // 't2s' | 's2t' | null
    let widthMode = null;  // 'fw2hw' | 'hw2fw' | null

    // 主要轉換函數
    const convert = () => {
      let text = $in.value || '';

      // 簡繁（最多只會有一個）
      if (scMode === 't2s' && convT2S) text = convT2S(text);
      if (scMode === 's2t' && convS2T) text = convS2T(text);

      // 全半形（最多只會有一個）
      if (widthMode === 'fw2hw') text = toHalfWidth(text);
      if (widthMode === 'hw2fw') text = toFullWidth(text);

      $out.value = text;
    };

    // 防抖（輸入時不會太卡）
    let timer = null;
    const debouncedConvert = () => {
      clearTimeout(timer);
      timer = setTimeout(convert, 150);
    };

    // 模式按鈕點擊
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const group = btn.dataset.group;
        const mode  = btn.dataset.mode;

        if (group === 'sc') {
          if (scMode === mode) {
            // 再次點擊 = 取消
            scMode = null;
            btn.classList.remove('active');
          } else {
            scMode = mode;
            // 同組其他按鈕取消 active
            document.querySelectorAll(`[data-group="sc"]`).forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            ensureOpenCC();
          }
        }

        if (group === 'width') {
          if (widthMode === mode) {
            widthMode = null;
            btn.classList.remove('active');
          } else {
            widthMode = mode;
            document.querySelectorAll(`[data-group="width"]`).forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
          }
        }

        convert();
      });
    });

    // 輸入即時更新
    $in.addEventListener('input', debouncedConvert);

    // 其他功能
    document.getElementById('btnClear').onclick = () => {
      $in.value = ''; $out.value = ''; $in.focus();
    };
    document.getElementById('btnCopyIn').onclick = async () => {
      if ($in.value) await navigator.clipboard.writeText($in.value);
    };
    document.getElementById('btnCopyOut').onclick = async () => {
      if ($out.value) await navigator.clipboard.writeText($out.value);
    };

    // 預載 OpenCC
    ensureOpenCC();
  </script>
</body>
</html>