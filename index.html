<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>簡繁．全形半形 轉換器</title>
  <link rel="icon" type="image/png" href="icon.png" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#94a3b8; --accent:#f59e0b; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Microsoft JhengHei", sans-serif; background:var(--bg); color:var(--ink);}
    header { padding:20px; border-bottom:1px solid #1f2937; }
    h1 { margin:0; font-size:20px; letter-spacing:.5px; }
    .wrap { max-width:1100px; margin:24px auto; padding:0 16px; display:grid; gap:16px; grid-template-columns:1fr; }
    .panel { background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:16px; }
    textarea { width:100%; min-height:260px; resize:vertical; background:#0b1220; color:var(--ink); border:1px solid #1f2937; border-radius:12px; padding:12px; font-size:15px; line-height:1.6; }
    .bar { display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; }
    button {
      border:1px solid #334155; background:#0b1220; color:var(--ink);
      padding:10px 14px; border-radius:999px; cursor:pointer; font-size:14px;
    }
    button:hover { border-color:var(--accent); color:var(--accent); }
    .muted { color:var(--muted); font-size:12px; margin-top:8px; }
    .two { display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width: 900px) { .two{ grid-template-columns:1fr 1fr; } }
    .tag { display:inline-block; padding:2px 8px; border:1px solid #334155; border-radius:999px; font-size:12px; color:var(--muted); }
    .footer { text-align:center; color:var(--muted); font-size:12px; padding:24px 0 40px; }
  </style>
  <!-- opencc-js（瀏覽器 UMD 版本；用於簡⇄繁詞彙級轉換） -->
  <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>
</head>
<body>
  <header>
    <h1>簡繁．全形半形 轉換器 <span class="tag">前端本地處理</span></h1>
  </header>

  <main class="wrap">
    <section class="two">
      <div class="panel">
        <h3 style="margin:0 0 8px;">輸入</h3>
        <textarea id="input" placeholder="貼上或輸入文字…"></textarea>
        <div class="bar">
          <button id="btnClear">清空</button>
          <button id="btnCopyIn">複製</button>
        </div>
        <p class="muted">提示：轉換只作用於文字，不會上傳任何內容；簡繁採用 <code>opencc-js</code> 詞彙級轉換。</p>
      </div>

      <div class="panel">
        <h3 style="margin:0 0 8px;">輸出</h3>
        <textarea id="output" placeholder="轉換結果會顯示在這裡" readonly></textarea>
        <div class="bar">
          <button id="btnCopyOut">複製</button>
        </div>
      </div>
    </section>

    <section class="panel">
      <h3 style="margin:0 0 8px;">轉換操作</h3>
      <div class="bar">
        <!-- 簡繁 -->
        <button id="btnT2S">繁 → 簡（zh-TW → zh-CN）</button>
        <button id="btnS2T">簡 → 繁（zh-CN → zh-TW/用語）</button>
        <!-- 全半形 -->
        <button id="btnFW2HW">全形 → 半形</button>
        <button id="btnHW2FW">半形 → 全形</button>
      </div>
    </section>
  </main>

  <div class="footer">opencc-js 提供簡繁詞彙轉換；全形半形為本頁原生 Unicode 映射。</div>

  <script>
    // ===== 全形 / 半形 =====
    function toHalfWidth(str) {
      // 全形空白 U+3000 → 空白 U+0020
      str = str.replace(/\u3000/g, ' ');
      // 全形（FF01–FF5E）→ 半形（0021–007E）
      return str.replace(/[\uFF01-\uFF5E]/g, ch =>
        String.fromCharCode(ch.charCodeAt(0) - 0xFEE0)
      );
    }
    function toFullWidth(str) {
      // 半形空白 → 全形空白 U+3000
      str = str.replace(/ /g, '\u3000');
      // 半形（0021–007E）→ 全形（FF01–FF5E）
      return str.replace(/[!-~]/g, ch =>
        String.fromCharCode(ch.charCodeAt(0) + 0xFEE0)
      );
    }

    // ===== 簡 / 繁（opencc-js）=====
    // 以臺灣繁體（tw / twp）與中國大陸簡體（cn）為主
    // from:tw → to:cn（繁→簡）；from:cn → to:twp（簡→繁且調整臺灣常用詞）
    let convT2S = null;
    let convS2T = null;
    function ensureOpenCC() {
      if (!window.OpenCC) return false;
      if (!convT2S) convT2S = OpenCC.Converter({ from: 'tw',  to: 'cn'  });
      if (!convS2T) convS2T = OpenCC.Converter({ from: 'cn',  to: 'twp' }); // twp：含詞彙轉換（自行車→腳踏車）
      return true;
    }

    // ===== UI 綁定 =====
    const $in  = document.getElementById('input');
    const $out = document.getElementById('output');

    function setOut(text) { $out.value = text; }

    document.getElementById('btnClear').addEventListener('click', () => { $in.value = ''; setOut(''); });
    document.getElementById('btnCopyIn').addEventListener('click', async () => {
      if (!$in.value) return;
      await navigator.clipboard.writeText($in.value);
    });
    document.getElementById('btnCopyOut').addEventListener('click', async () => {
      if (!$out.value) return;
      await navigator.clipboard.writeText($out.value);
    });

    // ==== 修正重點：永遠以「輸入框」為來源 ====
    // 繁 → 簡
    document.getElementById('btnT2S').addEventListener('click', () => {
      const ok = ensureOpenCC();
      const src = $in.value || '';
      if (!ok) return setOut('（載入簡繁轉換核心失敗，請檢查網路或稍後再試）\n\n' + src);
      setOut(convT2S(src));
    });

    // 簡 → 繁（臺灣用語）
    document.getElementById('btnS2T').addEventListener('click', () => {
      const ok = ensureOpenCC();
      const src = $in.value || '';
      if (!ok) return setOut('（載入簡繁轉換核心失敗，請檢查網路或稍後再試）\n\n' + src);
      setOut(convS2T(src));
    });

    // 全形 → 半形
    document.getElementById('btnFW2HW').addEventListener('click', () => {
      setOut(toHalfWidth($in.value || ''));
    });

    // 半形 → 全形
    document.getElementById('btnHW2FW').addEventListener('click', () => {
      setOut(toFullWidth($in.value || ''));
    });
  </script>
</body>
</html>
